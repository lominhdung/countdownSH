<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Elite Surgery Monitor - Saigon Eye Hospital</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;600;800&family=Inter:wght@700;900&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        :root {
            --navy: #0a192f;
            --gold: #c5a059;
            --glass: rgba(255, 255, 255, 0.95);
            --accent: #0047ab;
        }

        body {
            margin: 0; font-family: 'Plus Jakarta Sans', sans-serif;
            background: #f0f2f5;
            background-image: 
                radial-gradient(at 0% 0%, rgba(197, 160, 89, 0.1) 0px, transparent 50%),
                radial-gradient(at 100% 0%, rgba(0, 71, 171, 0.05) 0px, transparent 50%);
            height: 100vh; display: flex; justify-content: center; align-items: center; overflow: hidden;
        }

        .container {
            width: 100vw; height: 177.78vw; max-height: 100vh; max-width: 56.25vh;
            padding: 35px; box-sizing: border-box; display: flex; flex-direction: column;
            position: relative;
        }

        /* Luxury Header */
        .header { text-align: center; margin-bottom: 40px; position: relative; }
        .logo { height: 55px; margin-bottom: 15px; }
        .divider { width: 40px; height: 2px; background: var(--gold); margin: 10px auto; }
        .sys-text { font-size: 9px; letter-spacing: 3px; font-weight: 800; color: var(--navy); opacity: 0.6; }

        /* Main Glass Card */
        .display-card {
            background: var(--glass);
            border-radius: 45px;
            padding: 60px 20px;
            text-align: center;
            box-shadow: 0 40px 80px -20px rgba(0, 0, 0, 0.12);
            border: 1px solid rgba(255, 255, 255, 1);
            position: relative;
        }

        .label { font-size: 11px; font-weight: 800; color: var(--gold); letter-spacing: 4px; text-transform: uppercase; margin-bottom: 20px; }
        
        .number-wrap { position: relative; display: inline-block; }
        .main-count { 
            font-family: 'Inter', sans-serif; font-size: 105px; font-weight: 900; 
            color: var(--navy); line-height: 0.8; margin-bottom: 15px;
            letter-spacing: -4px;
        }

        /* Progress Section */
        .progress-section { margin-top: 45px; }
        .track { height: 10px; background: #e9ecef; border-radius: 20px; overflow: hidden; margin-bottom: 15px; }
        .bar { 
            height: 100%; width: 0%; 
            background: linear-gradient(90deg, var(--navy), var(--accent));
            border-radius: 20px; transition: width 2s cubic-bezier(0.16, 1, 0.3, 1);
        }
        .percentage { font-family: 'Inter', sans-serif; font-size: 55px; font-weight: 900; color: var(--navy); }

        /* Stats Grid */
        .stats { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 30px; }
        .stat-item { 
            background: white; border-radius: 30px; padding: 25px 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.03);
            border: 1px solid rgba(0,0,0,0.02);
        }
        .stat-val { font-family: 'Inter'; font-size: 28px; color: var(--navy); font-weight: 700; display: block; }
        .stat-lbl { font-size: 9px; font-weight: 700; color: #adb5bd; text-transform: uppercase; letter-spacing: 1px; }

        /* Victory Screen Luxury */
        #victory {
            position: fixed; inset: 0; background: #fff; z-index: 10000;
            display: none; flex-direction: column; justify-content: center; align-items: center;
        }
        .v-gold { color: var(--gold); font-family: 'Inter'; font-size: 40px; font-weight: 900; text-align: center; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .animate-up { animation: fadeIn 1s cubic-bezier(0.23, 1, 0.32, 1) forwards; }
    </style>
</head>
<body>

    <div id="victory">
        <div style="font-size: 100px;">⭐</div>
        <div class="v-gold">MISSION<br>ACCOMPLISHED</div>
        <p style="font-weight: 600; color: var(--navy); margin-top: 20px;">SAIGON EYE HOSPITAL - 2025</p>
    </div>

    <div class="container animate-up">
        <div class="header">
            <img src="logo.png" class="logo">
            <div class="divider"></div>
            <div class="sys-text">ELITE MONITORING SYSTEM</div>
        </div>

        <div class="display-card">
            <div class="label">Total Procedures</div>
            <div class="main-count" id="totalDisplay">0</div>
            
            <div class="progress-section">
                <div class="track"><div class="bar" id="progressBar"></div></div>
                <div class="percentage" id="percentDisplay">0%</div>
            </div>
        </div>

        <div class="stats">
            <div class="stat-item">
                <span class="stat-lbl">Annual Goal</span>
                <span class="stat-val" id="targetDisplay">0</span>
            </div>
            <div class="stat-item">
                <span class="stat-lbl">Remaining</span>
                <span class="stat-val" id="remainDisplay" style="color: var(--gold);">0</span>
            </div>
        </div>

        <div style="margin-top: auto; text-align: center; opacity: 0.3; font-size: 9px; letter-spacing: 2px;">
            SECURE REAL-TIME DATA • EST. 2025
        </div>
    </div>

    <script>
        const DB_URL = "https://cdsh-a2c06-default-rtdb.asia-southeast1.firebasedatabase.app/.json";
        let isDone = false;
        let currentTotal = 0;

        // Hàm hiệu ứng đếm số mượt mà
        function animateNumber(id, start, end, duration) {
            const obj = document.getElementById(id);
            let startTimestamp = null;
            const step = (timestamp) => {
                if (!startTimestamp) startTimestamp = timestamp;
                const progress = Math.min((timestamp - startTimestamp) / duration, 1);
                const val = Math.floor(progress * (end - start) + start);
                obj.innerHTML = val.toLocaleString();
                if (progress < 1) window.requestAnimationFrame(step);
            };
            window.requestAnimationFrame(step);
        }

        async function sync() {
            try {
                const res = await fetch(DB_URL);
                const data = await res.json();
                if(!data) return;

                const newTotal = data.total || 0;
                const target = data.target || 1000;
                const p = (newTotal/target) * 100;

                // Chỉ chạy animation nếu số thay đổi
                if(newTotal !== currentTotal) {
                    animateNumber("totalDisplay", currentTotal, newTotal, 1500);
                    currentTotal = newTotal;
                }

                document.getElementById("targetDisplay").innerText = target.toLocaleString();
                document.getElementById("remainDisplay").innerText = Math.max(0, target - newTotal).toLocaleString();
                document.getElementById("progressBar").style.width = Math.min(p, 100) + "%";
                document.getElementById("percentDisplay").innerText = Math.min(p, 100).toFixed(1) + "%";

                if(p >= 100 && !isDone) {
                    isDone = true;
                    document.getElementById("victory").style.display = "flex";
                    var end = Date.now() + (10 * 1000);
                    (function frame() {
                        confetti({ particleCount: 3, angle: 60, spread: 55, origin: { x: 0 }, colors: ['#c5a059', '#0a192f'] });
                        confetti({ particleCount: 3, angle: 120, spread: 55, origin: { x: 1 }, colors: ['#c5a059', '#0a192f'] });
                        if (Date.now() < end) requestAnimationFrame(frame);
                    }());
                } else if (p < 100) {
                    document.getElementById("victory").style.display = "none";
                    isDone = false;
                }
            } catch(e) {}
        }
        setInterval(sync, 2000);
        sync();
    </script>
</body>
</html>
